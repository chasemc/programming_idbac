
#  Working with IDBac from Python


```{r eval=FALSE, include=FALSE}

library(reticulate)
#use_virtualenv("r-reticulate")
# create a new environment 
#reticulate::virtualenv_create("idbac")
# install pandas
conda_install("r-reticulate", "pandas")
conda_install("r-reticulate", "plotly")
#reticulate::use_condaenv("r-C:\Users\CMC\AppData\Local\R-MINI~1\envsreticulate")

```


```{python}
import plotly.offline as py
import plotly.graph_objects as go

fig = go.Figure(data=go.Bar(y=[2, 3, 1]))
fig.show()

```

```{python}

py.plot(fig, filename = "data/python_output/1.html", auto_open=False)
```

```{r, echo=FALSE}
htmltools::includeHTML(here::here("data","python_output","1.html"))
```



```{python}
import sqlite3
import json
import pandas as pd
```

```{python}
conn = sqlite3.connect('C:/Users/CMC/Documents/GitHub/programming_idbac/data/databases/my_new_database.sqlite')
print(conn)
```

```{python}
c = conn.cursor()
```

```{python}
t = ('172-1',)
c.execute('SELECT min_mass FROM spectra WHERE strain_id=?', t)
print(c.fetchall())

```




```{python}
t = ('172-1',)
c.execute('SELECT peak_matrix FROM spectra WHERE strain_id=?', t)
peaks = c.fetchone()
```

```{python}
print(type(peaks))
```



Get 172-1 sample peak lists as pandas df:
```{python}
df = pd.read_sql_query('SELECT peak_matrix FROM spectra WHERE strain_id=:spec', conn, params = {'spec':'172-1'})
```



```{python}
print(df)
```



```{python}
js = df.iloc[0,0]

a = json.loads(js)

```


```{python}
type(a)
a = pd.DataFrame.from_dict(a)
print(a)
```

```{python}
a['mass'][1] 
```


```{python}
import plotly.graph_objects as go

fig = go.Figure()

fig.add_trace(go.Scatter(
    x=[1.5, 4.5],
    y=[0.75, 0.75],
    text=["Unfilled Rectangle", "Filled Rectangle"],
    mode="text",
))

for ind in a.index: 
  fig.add_shape(
          go.layout.Shape(
              type="rect",
              x0=a['mass'][ind] - 1,
              y0=0,
              x1=a['mass'][ind] + 1,
              y1=a['intensity'][ind],
              line=dict(
                  color="RoyalBlue",
                  width=2,
              ),
              fillcolor="LightSkyBlue",
          ))

fig.update_shapes(dict(xref='x', yref='y'))
fig.show()
```


