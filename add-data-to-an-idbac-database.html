<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 1 Add Data to an IDBac Database | 03_add_data_to_a_database.utf8</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 1 Add Data to an IDBac Database | 03_add_data_to_a_database.utf8" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 1 Add Data to an IDBac Database | 03_add_data_to_a_database.utf8" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  


<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path=""><a href="#add-data-to-an-idbac-database"><i class="fa fa-check"></i><b>1</b> Add Data to an IDBac Database</a><ul>
<li class="chapter" data-level="1.1" data-path=""><a href="#make-a-new-empty-idbac-database"><i class="fa fa-check"></i><b>1.1</b> Make a new empty IDBac database</a></li>
<li class="chapter" data-level="1.2" data-path=""><a href="#add-data-from-an-mzxml-file"><i class="fa fa-check"></i><b>1.2</b> Add data from an mzXML file</a></li>
<li class="chapter" data-level="1.3" data-path=""><a href="#adding-multiple-mzxml-files"><i class="fa fa-check"></i><b>1.3</b> Adding multiple mzXML files</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:title:end-->
<!--bookdown:title:start-->
<div id="add-data-to-an-idbac-database" class="section level1">
<h1><span class="header-section-number">Chapter 1</span> Add Data to an IDBac Database</h1>
<p>So, we’ve already seen how to connect to an existing IDBac database, and what an IDBac database consists of. In this section we’ll learn how to add our own data to a new, or exisisting, IDBac database.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(dplyr)</a></code></pre></div>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">library</span>(here)</a></code></pre></div>
<pre><code>## here() starts at C:/Users/CMC/Documents/GitHub/programming_idbac</code></pre>
<div id="make-a-new-empty-idbac-database" class="section level2">
<h2><span class="header-section-number">1.1</span> Make a new empty IDBac database</h2>
<p>We have five mzXML files in folder: <code>~data/mzxml</code></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">list.files</span>(here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;mzxml&quot;</span>))</a></code></pre></div>
<pre><code>## [1] &quot;172-1.mzXML&quot;  &quot;172-10.mzXML&quot; &quot;172-11.mzXML&quot; &quot;172-7.mzXML&quot;  &quot;Matrix.mzXML&quot;</code></pre>
<p>Create a new, empty, database named <code>my_new_database</code> in <code>~data/databases</code></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">IDBacApp<span class="op">::</span><span class="kw">idbac_create</span>(<span class="dt">fileName =</span> <span class="st">&quot;my_new_database&quot;</span>,</a>
<a class="sourceLine" id="cb9-2" title="2">                       <span class="dt">filePath =</span> here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;data&quot;</span>,</a>
<a class="sourceLine" id="cb9-3" title="3">                                             <span class="st">&quot;databases&quot;</span>))</a></code></pre></div>
<pre><code>## [1] &quot;C:/Users/CMC/Documents/GitHub/programming_idbac/data/databases/my_new_database.sqlite&quot;</code></pre>
<p>Connect to the new database</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">db_connection &lt;-<span class="st"> </span>IDBacApp<span class="op">::</span><span class="kw">idbac_connect</span>(<span class="dt">fileName =</span> <span class="st">&quot;my_new_database&quot;</span>,</a>
<a class="sourceLine" id="cb11-2" title="2">                                         <span class="dt">filePath =</span> here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;data&quot;</span>,</a>
<a class="sourceLine" id="cb11-3" title="3">                                                               <span class="st">&quot;databases&quot;</span>))</a></code></pre></div>
<p>It is indeed empty:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">dplyr<span class="op">::</span><span class="kw">tbl</span>(db_connection<span class="op">$</span>my_new_database,</a>
<a class="sourceLine" id="cb12-2" title="2">           <span class="st">&quot;spectra&quot;</span>)</a></code></pre></div>
<pre><code>## # Source:   table&lt;spectra&gt; [?? x 42]
## # Database: sqlite 3.30.1
## #   [C:\Users\CMC\Documents\GitHub\programming_idbac\data\databases\my_new_database.sqlite]
##    spectrum_mass_h… spectrum_intens… xml_hash strain_id peak_matrix
##    &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;      
##  1 e5da88690259ca7d 6028ecf5d313b045 9a4c3bb… 172-1     &quot;{\&quot;mass\&quot;…
##  2 e5da88690259ca7d bac07d6e5744cf4e 9a4c3bb… 172-1     &quot;{\&quot;mass\&quot;…
##  3 aad55e8ea8b426cd b7238aee3626ef85 9a4c3bb… 172-1     &quot;{\&quot;mass\&quot;…
##  4 aad55e8ea8b426cd 7ec32da4207c396a 9a4c3bb… 172-1     &quot;{\&quot;mass\&quot;…
##  5 e5da88690259ca7d 60f61ee538773cda 406e5e6… 172-10    &quot;{\&quot;mass\&quot;…
##  6 e5da88690259ca7d 48f154a0e6d3a584 406e5e6… 172-10    &quot;{\&quot;mass\&quot;…
##  7 aad55e8ea8b426cd 5d8fc715f0478a5a 406e5e6… 172-10    &quot;{\&quot;mass\&quot;…
##  8 aad55e8ea8b426cd 95922f4f84fa25e7 406e5e6… 172-10    &quot;{\&quot;mass\&quot;…
##  9 e5da88690259ca7d 1f7851d0ae1debcf 9f8b13a… 172-11    &quot;{\&quot;mass\&quot;…
## 10 e5da88690259ca7d 502b1ed5bc032cd9 9f8b13a… 172-11    &quot;{\&quot;mass\&quot;…
## # … with more rows, and 37 more variables: spectrum_intensity &lt;blob&gt;,
## #   max_mass &lt;int&gt;, min_mass &lt;int&gt;, ignore &lt;int&gt;, number &lt;int&gt;,
## #   time_delay &lt;int&gt;, time_delta &lt;dbl&gt;, calibration_constants &lt;chr&gt;,
## #   v1_tof_calibration &lt;chr&gt;, data_type &lt;chr&gt;, data_system &lt;chr&gt;,
## #   spectrometer_type &lt;chr&gt;, inlet &lt;chr&gt;, ionization_mode &lt;chr&gt;,
## #   acquisition_method &lt;chr&gt;, acquisition_date &lt;chr&gt;, acquisition_mode &lt;chr&gt;,
## #   tof_mode &lt;chr&gt;, acquisition_operator_mode &lt;chr&gt;, laser_attenuation &lt;int&gt;,
## #   digitizer_type &lt;chr&gt;, flex_control_version &lt;chr&gt;, id &lt;chr&gt;,
## #   instrument &lt;chr&gt;, instrument_id &lt;chr&gt;, instrument_type &lt;chr&gt;,
## #   mass_error &lt;dbl&gt;, laser_shots &lt;int&gt;, patch &lt;chr&gt;, path &lt;chr&gt;,
## #   laser_repetition &lt;chr&gt;, spot &lt;chr&gt;, spectrum_type &lt;chr&gt;,
## #   target_count &lt;chr&gt;, target_id_string &lt;chr&gt;, target_serial_number &lt;chr&gt;,
## #   target_type_number &lt;chr&gt;</code></pre>
</div>
<div id="add-data-from-an-mzxml-file" class="section level2">
<h2><span class="header-section-number">1.2</span> Add data from an mzXML file</h2>
<p>First let’s add just a single xml file</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">mz_file_paths &lt;-<span class="st"> </span>IDBacApp<span class="op">::</span><span class="kw">find_mz_files</span>(<span class="dt">path =</span> here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;mzxml&quot;</span>),</a>
<a class="sourceLine" id="cb14-2" title="2">                                         <span class="dt">recursive =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb14-3" title="3">                                         <span class="dt">full =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb14-4" title="4"><span class="co"># only use one</span></a>
<a class="sourceLine" id="cb14-5" title="5">mz_file_paths &lt;-<span class="st"> </span>mz_file_paths[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb14-6" title="6"></a>
<a class="sourceLine" id="cb14-7" title="7"><span class="kw">print</span>(mz_file_paths)</a></code></pre></div>
<pre><code>## [1] &quot;C:/Users/CMC/Documents/GitHub/programming_idbac/data/mzxml/172-1.mzXML&quot;</code></pre>
<p>Get the name:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">mz_file_name &lt;-<span class="st"> </span>base<span class="op">::</span><span class="kw">basename</span>(tools<span class="op">::</span><span class="kw">file_path_sans_ext</span>(mz_file_paths))</a>
<a class="sourceLine" id="cb16-2" title="2"></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="kw">print</span>(mz_file_name)</a></code></pre></div>
<pre><code>## [1] &quot;172-1&quot;</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">mz_file_name &lt;-<span class="st"> </span>base<span class="op">::</span><span class="kw">basename</span>(tools<span class="op">::</span><span class="kw">file_path_sans_ext</span>(mz_file_paths))</a>
<a class="sourceLine" id="cb18-2" title="2"></a>
<a class="sourceLine" id="cb18-3" title="3"></a>
<a class="sourceLine" id="cb18-4" title="4"></a>
<a class="sourceLine" id="cb18-5" title="5">IDBacApp<span class="op">::</span><span class="kw">process_mzml</span>(<span class="dt">mzFilePaths =</span> here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;mzxml&quot;</span>, <span class="kw">paste0</span>(mz_file_name, <span class="st">&quot;.mzXML&quot;</span>)),</a>
<a class="sourceLine" id="cb18-6" title="6">                       <span class="dt">sampleIds =</span> mz_file_name,</a>
<a class="sourceLine" id="cb18-7" title="7">                       <span class="dt">sqlDirectory =</span> sqlDirectory<span class="op">$</span>sqlDirectory,</a>
<a class="sourceLine" id="cb18-8" title="8">                       <span class="dt">idbac_pool =</span> db_connection<span class="op">$</span>my_new_database,</a>
<a class="sourceLine" id="cb18-9" title="9">                       <span class="dt">acquisitionInfo =</span> <span class="ot">NULL</span>)</a></code></pre></div>
<pre><code>## Processing in progress...</code></pre>
<pre><code>## Sample: 172-1; 1 of 1</code></pre>
<pre><code>## Warning in fun(libname, pkgname): mzR has been built against a different Rcpp version (1.0.2)
## than is installed on your system (1.0.3). This might lead to errors
## when loading mzR. If you encounter such issues, please send a report,
## including the output of sessionInfo() to the Bioc support forum at 
## https://support.bioconductor.org/. For details see also
## https://github.com/sneumann/mzR/wiki/mzR-Rcpp-compiler-linker-issue.</code></pre>
<pre><code>## Warning in .replaceNegativeIntensityValues(object): Negative intensity values
## are replaced by zeros.

## Warning in .replaceNegativeIntensityValues(object): Negative intensity values
## are replaced by zeros.</code></pre>
<p>Looking at what is contained within the database we see that four spectra were added to the table <code>spectra</code>.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1">dplyr<span class="op">::</span><span class="kw">tbl</span>(db_connection<span class="op">$</span>my_new_database, <span class="st">&quot;spectra&quot;</span>)</a></code></pre></div>
<pre><code>## # Source:   table&lt;spectra&gt; [?? x 42]
## # Database: sqlite 3.30.1
## #   [C:\Users\CMC\Documents\GitHub\programming_idbac\data\databases\my_new_database.sqlite]
##    spectrum_mass_h… spectrum_intens… xml_hash strain_id peak_matrix
##    &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;      
##  1 e5da88690259ca7d 6028ecf5d313b045 9a4c3bb… 172-1     &quot;{\&quot;mass\&quot;…
##  2 e5da88690259ca7d bac07d6e5744cf4e 9a4c3bb… 172-1     &quot;{\&quot;mass\&quot;…
##  3 aad55e8ea8b426cd b7238aee3626ef85 9a4c3bb… 172-1     &quot;{\&quot;mass\&quot;…
##  4 aad55e8ea8b426cd 7ec32da4207c396a 9a4c3bb… 172-1     &quot;{\&quot;mass\&quot;…
##  5 e5da88690259ca7d 60f61ee538773cda 406e5e6… 172-10    &quot;{\&quot;mass\&quot;…
##  6 e5da88690259ca7d 48f154a0e6d3a584 406e5e6… 172-10    &quot;{\&quot;mass\&quot;…
##  7 aad55e8ea8b426cd 5d8fc715f0478a5a 406e5e6… 172-10    &quot;{\&quot;mass\&quot;…
##  8 aad55e8ea8b426cd 95922f4f84fa25e7 406e5e6… 172-10    &quot;{\&quot;mass\&quot;…
##  9 e5da88690259ca7d 1f7851d0ae1debcf 9f8b13a… 172-11    &quot;{\&quot;mass\&quot;…
## 10 e5da88690259ca7d 502b1ed5bc032cd9 9f8b13a… 172-11    &quot;{\&quot;mass\&quot;…
## # … with more rows, and 37 more variables: spectrum_intensity &lt;blob&gt;,
## #   max_mass &lt;int&gt;, min_mass &lt;int&gt;, ignore &lt;int&gt;, number &lt;int&gt;,
## #   time_delay &lt;int&gt;, time_delta &lt;dbl&gt;, calibration_constants &lt;chr&gt;,
## #   v1_tof_calibration &lt;chr&gt;, data_type &lt;chr&gt;, data_system &lt;chr&gt;,
## #   spectrometer_type &lt;chr&gt;, inlet &lt;chr&gt;, ionization_mode &lt;chr&gt;,
## #   acquisition_method &lt;chr&gt;, acquisition_date &lt;chr&gt;, acquisition_mode &lt;chr&gt;,
## #   tof_mode &lt;chr&gt;, acquisition_operator_mode &lt;chr&gt;, laser_attenuation &lt;int&gt;,
## #   digitizer_type &lt;chr&gt;, flex_control_version &lt;chr&gt;, id &lt;chr&gt;,
## #   instrument &lt;chr&gt;, instrument_id &lt;chr&gt;, instrument_type &lt;chr&gt;,
## #   mass_error &lt;dbl&gt;, laser_shots &lt;int&gt;, patch &lt;chr&gt;, path &lt;chr&gt;,
## #   laser_repetition &lt;chr&gt;, spot &lt;chr&gt;, spectrum_type &lt;chr&gt;,
## #   target_count &lt;chr&gt;, target_id_string &lt;chr&gt;, target_serial_number &lt;chr&gt;,
## #   target_type_number &lt;chr&gt;</code></pre>
<p>One row was added in the table <code>metadata</code>.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1">dplyr<span class="op">::</span><span class="kw">tbl</span>(db_connection<span class="op">$</span>my_new_database, <span class="st">&quot;metadata&quot;</span>)</a></code></pre></div>
<pre><code>## # Source:   table&lt;metadata&gt; [?? x 20]
## # Database: sqlite 3.30.1
## #   [C:\Users\CMC\Documents\GitHub\programming_idbac\data\databases\my_new_database.sqlite]
##   strain_id genbank_accessi… ncbi_taxid kingdom phylum class order family genus
##   &lt;chr&gt;     &lt;chr&gt;            &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;
## 1 172-1     &lt;NA&gt;             &lt;NA&gt;       &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt; 
## 2 172-10    &lt;NA&gt;             &lt;NA&gt;       &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt; 
## 3 172-11    &lt;NA&gt;             &lt;NA&gt;       &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt; 
## 4 172-7     &lt;NA&gt;             &lt;NA&gt;       &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt; 
## 5 Matrix    &lt;NA&gt;             &lt;NA&gt;       &lt;NA&gt;    &lt;NA&gt;   &lt;NA&gt;  &lt;NA&gt;  &lt;NA&gt;   &lt;NA&gt; 
## # … with 11 more variables: species &lt;chr&gt;, maldi_matrix &lt;chr&gt;,
## #   dsm_cultivation_media &lt;chr&gt;, cultivation_temp_celsius &lt;chr&gt;,
## #   cultivation_time_days &lt;chr&gt;, cultivation_other &lt;chr&gt;,
## #   user_firstname_lastname &lt;chr&gt;, user_orcid &lt;chr&gt;,
## #   pi_firstname_lastname &lt;chr&gt;, pi_orcid &lt;chr&gt;, dna_16s &lt;chr&gt;</code></pre>
<p>Two rows were added in the table <code>mass_index</code> (one for the reflectron spectra and one for the protein spectra).</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1">dplyr<span class="op">::</span><span class="kw">tbl</span>(db_connection<span class="op">$</span>my_new_database, <span class="st">&quot;mass_index&quot;</span>)</a></code></pre></div>
<pre><code>## # Source:   table&lt;mass_index&gt; [?? x 2]
## # Database: sqlite 3.30.1
## #   [C:\Users\CMC\Documents\GitHub\programming_idbac\data\databases\my_new_database.sqlite]
##   spectrum_mass_hash     mass_vector
##   &lt;chr&gt;                       &lt;blob&gt;
## 1 e5da88690259ca7d   &lt;raw 956.22 kB&gt;
## 2 aad55e8ea8b426cd   &lt;raw 203.16 kB&gt;</code></pre>
<p>One row was added in the table <code>xml</code>. This contains the original mzXML file.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1">dplyr<span class="op">::</span><span class="kw">tbl</span>(db_connection<span class="op">$</span>my_new_database, <span class="st">&quot;xml&quot;</span>)</a></code></pre></div>
<pre><code>## # Source:   table&lt;xml&gt; [?? x 8]
## # Database: sqlite 3.30.1
## #   [C:\Users\CMC\Documents\GitHub\programming_idbac\data\databases\my_new_database.sqlite]
##   xml_hash           xml manufacturer model ionization analyzer detector
##   &lt;chr&gt;           &lt;blob&gt; &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;   
## 1 9a4c3bb… &lt;raw 5.11 MB&gt; Bruker Dalt… Bruk… matrix-as… time-of… microch…
## 2 406e5e6… &lt;raw 4.97 MB&gt; Bruker Dalt… Bruk… matrix-as… time-of… microch…
## 3 9f8b13a… &lt;raw 5.13 MB&gt; Bruker Dalt… Bruk… matrix-as… time-of… microch…
## 4 be133b9… &lt;raw 5.09 MB&gt; Bruker Dalt… Bruk… matrix-as… time-of… microch…
## 5 22b22a5… &lt;raw 2.16 MB&gt; Bruker Dalt… Bruk… matrix-as… time-of… microch…
## # … with 1 more variable: instrument_metafile &lt;chr&gt;</code></pre>
</div>
<div id="adding-multiple-mzxml-files" class="section level2">
<h2><span class="header-section-number">1.3</span> Adding multiple mzXML files</h2>
<p>It is also possible to add multiple mzXML/mzML files at once, simply pass multiple paths and names as character vectors to <code>IDBacApp::process_mzml()</code>.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" title="1">mz_file_paths &lt;-<span class="st"> </span>IDBacApp<span class="op">::</span><span class="kw">find_mz_files</span>(<span class="dt">path =</span> here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;mzxml&quot;</span>),</a>
<a class="sourceLine" id="cb31-2" title="2">                                         <span class="dt">recursive =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb31-3" title="3">                                         <span class="dt">full =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb31-4" title="4"><span class="kw">print</span>(mz_file_paths)</a></code></pre></div>
<pre><code>## [1] &quot;C:/Users/CMC/Documents/GitHub/programming_idbac/data/mzxml/172-1.mzXML&quot; 
## [2] &quot;C:/Users/CMC/Documents/GitHub/programming_idbac/data/mzxml/172-10.mzXML&quot;
## [3] &quot;C:/Users/CMC/Documents/GitHub/programming_idbac/data/mzxml/172-11.mzXML&quot;
## [4] &quot;C:/Users/CMC/Documents/GitHub/programming_idbac/data/mzxml/172-7.mzXML&quot; 
## [5] &quot;C:/Users/CMC/Documents/GitHub/programming_idbac/data/mzxml/Matrix.mzXML&quot;</code></pre>
<p>Names we will use:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" title="1">mz_file_names &lt;-<span class="st"> </span>base<span class="op">::</span><span class="kw">basename</span>(tools<span class="op">::</span><span class="kw">file_path_sans_ext</span>(mz_file_paths))</a>
<a class="sourceLine" id="cb33-2" title="2"></a>
<a class="sourceLine" id="cb33-3" title="3"><span class="kw">print</span>(mz_file_names)</a></code></pre></div>
<pre><code>## [1] &quot;172-1&quot;  &quot;172-10&quot; &quot;172-11&quot; &quot;172-7&quot;  &quot;Matrix&quot;</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" title="1">IDBacApp<span class="op">::</span><span class="kw">process_mzml</span>(<span class="dt">mzFilePaths =</span> mz_file_paths,</a>
<a class="sourceLine" id="cb35-2" title="2">                       <span class="dt">sampleIds =</span> mz_file_names,</a>
<a class="sourceLine" id="cb35-3" title="3">                       <span class="dt">sqlDirectory =</span> sqlDirectory<span class="op">$</span>sqlDirectory,</a>
<a class="sourceLine" id="cb35-4" title="4">                       <span class="dt">idbac_pool =</span> db_connection<span class="op">$</span>my_new_database,</a>
<a class="sourceLine" id="cb35-5" title="5">                       <span class="dt">acquisitionInfo =</span> <span class="ot">NULL</span>)</a></code></pre></div>
<pre><code>## Processing in progress...</code></pre>
<pre><code>## Sample: 172-1; 1 of 5</code></pre>
<pre><code>## Warning in .replaceNegativeIntensityValues(object): Negative intensity values
## are replaced by zeros.

## Warning in .replaceNegativeIntensityValues(object): Negative intensity values
## are replaced by zeros.</code></pre>
<pre><code>## Processing in progress...</code></pre>
<pre><code>## Sample: 172-10; 2 of 5</code></pre>
<pre><code>## Warning in .replaceNegativeIntensityValues(object): Negative intensity values
## are replaced by zeros.

## Warning in .replaceNegativeIntensityValues(object): Negative intensity values
## are replaced by zeros.</code></pre>
<pre><code>## Processing in progress...</code></pre>
<pre><code>## Sample: 172-11; 3 of 5</code></pre>
<pre><code>## Warning in .replaceNegativeIntensityValues(object): Negative intensity values
## are replaced by zeros.

## Warning in .replaceNegativeIntensityValues(object): Negative intensity values
## are replaced by zeros.</code></pre>
<pre><code>## Processing in progress...</code></pre>
<pre><code>## Sample: 172-7; 4 of 5</code></pre>
<pre><code>## Warning in .replaceNegativeIntensityValues(object): Negative intensity values
## are replaced by zeros.

## Warning in .replaceNegativeIntensityValues(object): Negative intensity values
## are replaced by zeros.</code></pre>
<pre><code>## Processing in progress...</code></pre>
<pre><code>## Sample: Matrix; 5 of 5</code></pre>
<pre><code>## Warning in .replaceNegativeIntensityValues(object): Negative intensity values
## are replaced by zeros.</code></pre>
<p>We can see below that this has now added data for all of the mzXML files given.</p>
<p>Important things to note:</p>
<ol style="list-style-type: decimal">
<li>The data from <code>172-1</code> was only added the first time. IDBac only appends data, it <em>never</em> overwrites data in the database (except in the metadata table). IDBac looks at each spectrum_mass_hash, spectrum_intensity_hash, and strain_id and only creates a new entry if those are unique from something already existing in the database.</li>
</ol>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" title="1">dplyr<span class="op">::</span><span class="kw">tbl</span>(db_connection<span class="op">$</span>my_new_database,</a>
<a class="sourceLine" id="cb51-2" title="2">           <span class="st">&quot;spectra&quot;</span>)</a></code></pre></div>
<pre><code>## # Source:   table&lt;spectra&gt; [?? x 42]
## # Database: sqlite 3.30.1
## #   [C:\Users\CMC\Documents\GitHub\programming_idbac\data\databases\my_new_database.sqlite]
##    spectrum_mass_h… spectrum_intens… xml_hash strain_id peak_matrix
##    &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;      
##  1 e5da88690259ca7d 6028ecf5d313b045 9a4c3bb… 172-1     &quot;{\&quot;mass\&quot;…
##  2 e5da88690259ca7d bac07d6e5744cf4e 9a4c3bb… 172-1     &quot;{\&quot;mass\&quot;…
##  3 aad55e8ea8b426cd b7238aee3626ef85 9a4c3bb… 172-1     &quot;{\&quot;mass\&quot;…
##  4 aad55e8ea8b426cd 7ec32da4207c396a 9a4c3bb… 172-1     &quot;{\&quot;mass\&quot;…
##  5 e5da88690259ca7d 60f61ee538773cda 406e5e6… 172-10    &quot;{\&quot;mass\&quot;…
##  6 e5da88690259ca7d 48f154a0e6d3a584 406e5e6… 172-10    &quot;{\&quot;mass\&quot;…
##  7 aad55e8ea8b426cd 5d8fc715f0478a5a 406e5e6… 172-10    &quot;{\&quot;mass\&quot;…
##  8 aad55e8ea8b426cd 95922f4f84fa25e7 406e5e6… 172-10    &quot;{\&quot;mass\&quot;…
##  9 e5da88690259ca7d 1f7851d0ae1debcf 9f8b13a… 172-11    &quot;{\&quot;mass\&quot;…
## 10 e5da88690259ca7d 502b1ed5bc032cd9 9f8b13a… 172-11    &quot;{\&quot;mass\&quot;…
## # … with more rows, and 37 more variables: spectrum_intensity &lt;blob&gt;,
## #   max_mass &lt;int&gt;, min_mass &lt;int&gt;, ignore &lt;int&gt;, number &lt;int&gt;,
## #   time_delay &lt;int&gt;, time_delta &lt;dbl&gt;, calibration_constants &lt;chr&gt;,
## #   v1_tof_calibration &lt;chr&gt;, data_type &lt;chr&gt;, data_system &lt;chr&gt;,
## #   spectrometer_type &lt;chr&gt;, inlet &lt;chr&gt;, ionization_mode &lt;chr&gt;,
## #   acquisition_method &lt;chr&gt;, acquisition_date &lt;chr&gt;, acquisition_mode &lt;chr&gt;,
## #   tof_mode &lt;chr&gt;, acquisition_operator_mode &lt;chr&gt;, laser_attenuation &lt;int&gt;,
## #   digitizer_type &lt;chr&gt;, flex_control_version &lt;chr&gt;, id &lt;chr&gt;,
## #   instrument &lt;chr&gt;, instrument_id &lt;chr&gt;, instrument_type &lt;chr&gt;,
## #   mass_error &lt;dbl&gt;, laser_shots &lt;int&gt;, patch &lt;chr&gt;, path &lt;chr&gt;,
## #   laser_repetition &lt;chr&gt;, spot &lt;chr&gt;, spectrum_type &lt;chr&gt;,
## #   target_count &lt;chr&gt;, target_id_string &lt;chr&gt;, target_serial_number &lt;chr&gt;,
## #   target_type_number &lt;chr&gt;</code></pre>
<p>The <code>mass-index</code> table remains the same because in this case all the data had the same mass values across all protein and small molecule spectra.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" title="1">dplyr<span class="op">::</span><span class="kw">tbl</span>(db_connection<span class="op">$</span>my_new_database,</a>
<a class="sourceLine" id="cb53-2" title="2">           <span class="st">&quot;mass_index&quot;</span>)</a></code></pre></div>
<pre><code>## # Source:   table&lt;mass_index&gt; [?? x 2]
## # Database: sqlite 3.30.1
## #   [C:\Users\CMC\Documents\GitHub\programming_idbac\data\databases\my_new_database.sqlite]
##   spectrum_mass_hash     mass_vector
##   &lt;chr&gt;                       &lt;blob&gt;
## 1 e5da88690259ca7d   &lt;raw 956.22 kB&gt;
## 2 aad55e8ea8b426cd   &lt;raw 203.16 kB&gt;</code></pre>
</div>
</div>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/%s",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
},
"search": false
});
});
</script>

</body>

</html>
